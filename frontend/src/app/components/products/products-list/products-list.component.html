<div class="products-list-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1>Productos</h1>
        <div class="header-info">
          <span class="info-icon" title="Explora y descubre productos de calidad">ℹ️</span>
          <span class="product-count">{{ totalItems }} productos</span>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="toggleFilters()">
          <i class="fas fa-filter"></i>
          Filtros ({{ getActiveFiltersCount() }})
        </button>
        <button class="btn btn-outline" (click)="toggleViewMode()">
          <i class="fas" [class.fa-th-large]="viewMode === 'grid'" [class.fa-list]="viewMode === 'list'"></i>
          {{ viewMode === 'grid' ? 'Vista de lista' : 'Vista de cuadrícula' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-section">
    <div class="search-container">
      <i class="fas fa-search search-icon"></i>
      <input 
        type="text" 
        class="search-input"
        placeholder="Buscar productos..."
        (input)="onSearch($event)"
        [formControl]="searchForm.get('search')">
      <button class="search-btn" *ngIf="searchTerm" (click)="clearFilters()">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- Category Navigation -->
  <div class="category-section">
    <div class="category-carousel">
      <button 
        class="category-btn" 
        [class.active]="selectedCategory === ''"
        (click)="onCategoryChange('')">
        <i class="fas fa-th"></i>
        <span>Todas</span>
      </button>
      <button 
        *ngFor="let category of categories" 
        class="category-btn"
        [class.active]="selectedCategory === category.id"
        (click)="onCategoryChange(category.id)"
        [title]="category.name">
        <i class="fas fa-{{ category.icon }}"></i>
        <span>{{ category.name }}</span>
      </button>
    </div>
  </div>

  <!-- Filters Panel -->
  <div class="filters-panel" [class.show]="showFilters">
    <div class="filters-content">
      <div class="filters-header">
        <h3>Filtros</h3>
        <button class="close-filters-btn" (click)="toggleFilters()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="filterForm" class="filters-form">
        <!-- Category Filter -->
        <div class="filter-group">
          <label>Categoría</label>
          <select formControlName="category" (change)="onCategoryChange(filterForm.get('category')?.value)">
            <option value="">Todas las categorías</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>

        <!-- Subcategory Filter -->
        <div class="filter-group" *ngIf="selectedCategory">
          <label>Subcategoría</label>
          <select formControlName="subcategory" (change)="onSubcategoryChange(filterForm.get('subcategory')?.value)">
            <option value="">Todas las subcategorías</option>
            <option *ngFor="let subcategory of categories.find(c => c.id === selectedCategory)?.subcategories" [value]="subcategory.id">
              {{ subcategory.name }}
            </option>
          </select>
        </div>

        <!-- Price Range Filter -->
        <div class="filter-group">
          <label>Rango de precios</label>
          <div class="price-range">
            <input type="number" formControlName="minPrice" placeholder="Min" min="0">
            <span>-</span>
            <input type="number" formControlName="maxPrice" placeholder="Max" min="0">
          </div>
        </div>

        <!-- Rating Filter -->
        <div class="filter-group">
          <label>Valoración mínima</label>
          <select formControlName="rating">
            <option value="">Cualquier valoración</option>
            <option *ngFor="let option of ratingOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <!-- Checkbox Filters -->
        <div class="filter-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="isOnSale">
            <span class="checkmark"></span>
            Solo productos en oferta
          </label>
        </div>

        <div class="filter-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="inStock">
            <span class="checkmark"></span>
            Solo productos disponibles
          </label>
        </div>
      </form>

      <div class="filters-actions">
        <button class="btn btn-secondary" (click)="clearFilters()">
          Limpiar filtros
        </button>
        <button class="btn btn-primary" (click)="applyFilters()">
          Aplicar filtros
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar Filters (Desktop) -->
    <div class="sidebar-filters">
      <div class="filter-section">
        <h3>Ordenar por</h3>
        <select [(ngModel)]="selectedSort" (change)="onSortChange(selectedSort)" class="sort-select">
          <option *ngFor="let option of sortOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <div class="filter-section" *ngIf="hasActiveFilters()">
        <h3>Filtros activos</h3>
        <div class="active-filters">
          <span *ngIf="selectedCategory" class="filter-tag">
            {{ getCategoryName(selectedCategory) }}
            <button (click)="onCategoryChange('')">×</button>
          </span>
          <span *ngIf="selectedSubcategory" class="filter-tag">
            {{ getSubcategoryName(selectedCategory, selectedSubcategory) }}
            <button (click)="onSubcategoryChange('')">×</button>
          </span>
          <span *ngIf="searchTerm" class="filter-tag">
            Búsqueda: "{{ searchTerm }}"
            <button (click)="searchForm.patchValue({search: ''}); onSearch({target: {value: ''}} as any)">×</button>
          </span>
        </div>
        <button class="btn btn-outline btn-sm" (click)="clearFilters()">
          Limpiar todos
        </button>
      </div>
    </div>

    <!-- Products Grid/List -->
    <div class="products-content">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Cargando productos...</p>
      </div>

      <!-- No Results State -->
      <div *ngIf="!loading && products.length === 0" class="no-results">
        <i class="fas fa-search"></i>
        <h3>No se encontraron productos</h3>
        <p>Intenta ajustar los filtros o términos de búsqueda</p>
        <button class="btn btn-primary" (click)="clearFilters()">
          Limpiar filtros
        </button>
      </div>

      <!-- Products Grid/List -->
      <div *ngIf="!loading && products.length > 0" class="products-container" [class.grid-view]="viewMode === 'grid'" [class.list-view]="viewMode === 'list'">
        <div *ngFor="let product of products" class="product-card" [class.list-card]="viewMode === 'list'">
          <!-- Product Image -->
          <div class="product-image">
            <img *ngIf="product.images.length > 0" [src]="product.images[0]" [alt]="product.name">
            <div *ngIf="product.images.length === 0" class="no-image">
              <i class="fas fa-image"></i>
            </div>
            
            <!-- Product Badges -->
            <div class="product-badges">
              <span *ngIf="product.isOnSale" class="badge sale-badge">
                -{{ getProductDiscount(product) }}%
              </span>
              <span *ngIf="!product.isAvailable" class="badge unavailable-badge">
                No disponible
              </span>
              <span *ngIf="product.stock < 10 && product.stock > 0" class="badge low-stock-badge">
                Últimas unidades
              </span>
            </div>

            <!-- Wishlist Button -->
            <button class="wishlist-btn" (click)="addToWishlist(product)">
              <i class="far fa-heart"></i>
            </button>
          </div>

          <!-- Product Info -->
          <div class="product-info">
            <div class="product-header">
              <h3 class="product-name" (click)="viewProduct(product)">{{ product.name }}</h3>
              <div class="supplier-info">
                <img *ngIf="product.supplier.logo" [src]="product.supplier.logo" [alt]="product.supplier.name" class="supplier-logo">
                <span class="supplier-name">{{ product.supplier.name }}</span>
              </div>
            </div>

            <p class="product-description" *ngIf="viewMode === 'list'">{{ product.description }}</p>

            <div class="product-category">
              <span class="category-badge">{{ getCategoryName(product.category) }}</span>
              <span *ngIf="product.subcategory" class="subcategory-badge">{{ getSubcategoryName(product.category, product.subcategory) }}</span>
            </div>

            <div class="product-rating" *ngIf="product.rating > 0">
              <div class="stars">
                <i *ngFor="let star of [1,2,3,4,5]" class="fas fa-star" [class.filled]="star <= product.rating"></i>
              </div>
              <span class="rating-text">{{ product.rating }} ({{ product.reviewCount }})</span>
            </div>

            <div class="product-price">
              <span class="current-price">{{ formatPrice(product.price) }}</span>
              <span *ngIf="product.originalPrice && product.originalPrice > product.price" class="original-price">
                {{ formatPrice(product.originalPrice) }}
              </span>
              <span *ngIf="product.unit" class="price-unit">/ {{ product.unit }}</span>
            </div>

            <div class="product-stock" [class]="getProductStatusClass(product)">
              <i class="fas fa-box"></i>
              {{ getProductStatusText(product) }}
            </div>

            <div class="product-actions">
              <button class="btn btn-primary btn-sm" [disabled]="!product.isAvailable || product.stock === 0">
                <i class="fas fa-shopping-cart"></i>
                Añadir al carrito
              </button>
              <button class="btn btn-outline btn-sm" (click)="viewProduct(product)">
                <i class="fas fa-eye"></i>
                Ver detalles
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div *ngIf="!loading && totalPages > 1" class="pagination-section">
        <div class="pagination-info">
          <span>Mostrando {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalItems) }} de {{ totalItems }} productos</span>
          <select [(ngModel)]="pageSize" (change)="onPageSizeChange(pageSize)" class="page-size-select">
            <option value="12">12 por página</option>
            <option value="24">24 por página</option>
            <option value="48">48 por página</option>
          </select>
        </div>
        <div class="pagination-buttons">
          <button 
            class="btn btn-outline btn-sm"
            [disabled]="currentPage === 1"
            (click)="onPageChange(currentPage - 1)">
            <i class="fas fa-chevron-left"></i>
            Anterior
          </button>
          <span class="page-numbers">
            <button 
              *ngFor="let page of getPageNumbers()" 
              class="btn btn-sm"
              [class.btn-primary]="page === currentPage"
              [class.btn-outline]="page !== currentPage"
              (click)="onPageChange(page)">
              {{ page }}
            </button>
          </span>
          <button 
            class="btn btn-outline btn-sm"
            [disabled]="currentPage >= totalPages"
            (click)="onPageChange(currentPage + 1)">
            Siguiente
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>