<div class="client-dashboard">
  <mat-card class="bi-header">
    <mat-card-content>
      <div class="bi-header-content">
        <div class="bi-title">
          <mat-icon>insights</mat-icon>
          <span>Información del Cliente</span>
        </div>
        <div class="bi-subtitle">Análisis de rendimiento y tendencias</div>
        <div class="bi-actions">
          <button mat-stroked-button color="primary" (click)="onRefreshData()">
            <mat-icon>refresh</mat-icon>
            Actualizar
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="bi-filters mat-elevation-z1">
    <mat-card-content>
      <div class="filters-row">
        <mat-button-toggle-group name="metric" [(ngModel)]="metricSelected" class="metric-tabs" appearance="legacy">
          <mat-button-toggle value="sales">Sales</mat-button-toggle>
          <mat-button-toggle value="orders">Orders</mat-button-toggle>
          <mat-button-toggle value="delivery">Delivery date</mat-button-toggle>
        </mat-button-toggle-group>
        <mat-form-field appearance="outline" class="filter-search">
          <mat-label>Choose filter</mat-label>
          <input matInput placeholder="Stores, supplier, delivery date..." />
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-range">
          <mat-label>Fecha</mat-label>
          <input matInput placeholder="1 Feb 2022 - 31 Jan 2023" />
          <button mat-icon-button matSuffix aria-label="calendar">
            <mat-icon>calendar_today</mat-icon>
          </button>
        </mat-form-field>

        <button mat-stroked-button color="primary">
          <mat-icon>add</mat-icon>
          Add comparison
        </button>

        <button mat-raised-button color="primary">
          <mat-icon>auto_graph</mat-icon>
          Generate
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="kpis-grid">
    <mat-card class="kpi-card">
      <mat-card-title>Total Orders</mat-card-title>
      <mat-card-content>{{ stats.totalOrders | number }}</mat-card-content>
    </mat-card>
    <mat-card class="kpi-card">
      <mat-card-title>Total Spent</mat-card-title>
      <mat-card-content>{{ stats.totalSpent | number:'1.0-0' }}</mat-card-content>
    </mat-card>
    <mat-card class="kpi-card">
      <mat-card-title>Avg Order</mat-card-title>
      <mat-card-content>{{ stats.averageOrderValue | number:'1.0-0' }}</mat-card-content>
    </mat-card>
    <mat-card class="kpi-card">
      <mat-card-title>Pending</mat-card-title>
      <mat-card-content>{{ stats.pendingOrders }}</mat-card-content>
    </mat-card>
  </div>

  <mat-card class="bi-chart mat-elevation-z1" [class.loading]="isLoading">
    <mat-card-content>
      <div class="chart-wrapper">
        <div class="skeleton" *ngIf="isLoading"></div>
        <canvas *ngIf="!isLoading" baseChart
                [type]="'line'"
                [data]="chartData"
                [options]="chartOptions">
        </canvas>
        <div class="chart-legend">
          <span class="legend-item legend-sales">Sales</span>
          <span class="legend-item legend-orders">Orders</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="bi-table mat-elevation-z1">
    <mat-card-content>
      <div class="table-empty" *ngIf="!isLoading && dataSource.data.length === 0">
        <mat-icon>inbox</mat-icon>
        <p>No hay datos disponibles en el rango seleccionado.</p>
      </div>
      <table *ngIf="dataSource.data.length > 0" mat-table [dataSource]="dataSource" matSort class="mat-elevation-z0 full-width sticky-header">
        <ng-container matColumnDef="store">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Store </th>
          <td mat-cell *matCellDef="let row"> {{ row.store }} </td>
        </ng-container>

        <ng-container matColumnDef="sales">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Sales € </th>
          <td mat-cell *matCellDef="let row"> {{ row.sales | number:'1.0-0' }} </td>
        </ng-container>

        <ng-container matColumnDef="orders">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Orders </th>
          <td mat-cell *matCellDef="let row"> {{ row.orders }} </td>
        </ng-container>

        <ng-container matColumnDef="avgOrder">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Average order € </th>
          <td mat-cell *matCellDef="let row"> {{ row.avgOrder | number:'1.0-0' }} </td>
        </ng-container>

        <ng-container matColumnDef="frequency">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Frequency </th>
          <td mat-cell *matCellDef="let row"> {{ row.frequency }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <mat-paginator [pageSize]="10" [pageSizeOptions]="[5,10,20]" showFirstLastButtons></mat-paginator>
    </mat-card-content>
  </mat-card>
</div>