<mat-toolbar class="header-toolbar" color="primary">
  <div class="header-content">
    <!-- Left side - Branding and Search -->
    <div class="header-left">
      <!-- Branding -->
      <div class="branding-section">
        <h1 class="brand-title">CESTO AI</h1>
        <span class="brand-subtitle">Supply Chain Platform</span>
      </div>
      
      <!-- Search Section -->
      <div class="search-section">
        <div class="search-container">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>{{ 'search.placeholder' | translate }}</mat-label>
            <input 
              matInput 
              type="text" 
              [(ngModel)]="searchQuery"
              (input)="onSearchInput()"
              (focus)="onSearchFocus()"
              (blur)="onSearchBlur()"
              (keydown)="onKeyDown($event)"
              placeholder="{{ 'search.placeholder' | translate }}"
              autocomplete="off">
            <mat-icon matPrefix class="search-icon">search</mat-icon>
            <button 
              *ngIf="searchQuery" 
              matSuffix 
              mat-icon-button 
              (click)="clearSearch()"
              class="clear-button"
              [attr.aria-label]="'search.clear' | translate">
              <mat-icon>close</mat-icon>
            </button>
          </mat-form-field>
          
          <!-- Search Suggestions Dropdown -->
          <div 
            *ngIf="showSuggestions && searchSuggestions.length > 0" 
            class="search-suggestions">
            <div class="suggestions-header">
              <span class="suggestions-title">{{ 'search.suggestions' | translate }}</span>
              <button 
                mat-icon-button 
                (click)="clearRecentSearches()"
                class="clear-recent-button"
                [attr.aria-label]="'search.clearRecent' | translate">
                <mat-icon>clear_all</mat-icon>
              </button>
            </div>
            <div class="suggestions-list">
              <div 
                *ngFor="let suggestion of searchSuggestions; let i = index"
                class="suggestion-item"
                [class.selected]="i === selectedSuggestionIndex"
                (click)="selectSuggestion(suggestion)"
                (mouseenter)="selectedSuggestionIndex = i">
                <mat-icon class="suggestion-icon">{{ suggestion.icon }}</mat-icon>
                <div class="suggestion-content">
                  <div class="suggestion-title">{{ suggestion.title }}</div>
                  <div class="suggestion-subtitle">{{ suggestion.subtitle }}</div>
                </div>
                <div class="suggestion-type">{{ suggestion.type | translate }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right side - Controls in correct order -->
    <div class="header-right">
      <!-- User Profile Section -->
      <div class="user-profile" *ngIf="currentUser" (click)="onProfile()" style="cursor: pointer;" title="Perfil">
        <div class="user-avatar">
          <mat-icon>person</mat-icon>
        </div>
        <div class="user-info">
          <span class="user-name">{{ userDisplayName }}</span>
          <span class="user-role">{{ getRoleDisplayName() }}</span>
        </div>
      </div>

      <!-- Language selector -->
      <app-language-selector></app-language-selector>

      <!-- Notifications -->
      <div class="notifications-wrapper">
        <button mat-icon-button 
                class="action-button" 
                [matTooltip]="'navigation.notifications' | translate"
                (click)="onNotifications()">
          <mat-icon>notifications</mat-icon>
        </button>
      </div>

      <!-- Settings button -->
      <button mat-icon-button 
              class="action-button" 
              [matTooltip]="'navigation.settings' | translate"
              (click)="onSettings()">
        <mat-icon>settings</mat-icon>
      </button>

      <!-- Help button -->
      <button mat-icon-button 
              class="action-button" 
              [matTooltip]="'navigation.help' | translate"
              (click)="onHelp()">
        <mat-icon>help_outline</mat-icon>
      </button>

      <!-- Logout button -->
      <button mat-icon-button 
              class="action-button" 
              [matTooltip]="'navigation.logout' | translate"
              (click)="onLogout()">
        <mat-icon>logout</mat-icon>
      </button>
    </div>
  </div>
</mat-toolbar>
