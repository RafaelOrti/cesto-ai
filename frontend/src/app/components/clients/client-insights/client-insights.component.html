<div class="client-insights">
  <!-- Professional Header -->
  <mat-card class="insights-header-card">
    <mat-card-content>
      <div class="header-content">
        <div class="header-info">
          <h1 class="insights-title">
            <mat-icon class="title-icon">analytics</mat-icon>
            {{ 'clientInsights.title' | translate }}
          </h1>
          <p class="insights-subtitle">Análisis detallado del rendimiento de clientes y tendencias de negocio</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Professional Controls -->
  <mat-card class="controls-card">
    <mat-card-content>
      <div class="controls-section">
        <div class="filter-controls">
          <div class="tab-filters">
            <button mat-stroked-button
                    *ngFor="let tab of filters"
                    [color]="selectedFilter===tab ? 'primary' : undefined"
                    [class.active]="selectedFilter===tab"
                    (click)="onFilterChange(tab)">{{ tab }}</button>
          </div>
          
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Fecha desde</mat-label>
            <input matInput type="date" [(ngModel)]="dateRange.from" (change)="onDateRangeChange()">
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Fecha hasta</mat-label>
            <input matInput type="date" [(ngModel)]="dateRange.to" (change)="onDateRangeChange()">
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>{{ 'common.search' | translate }}</mat-label>
            <input matInput type="text" (input)="applySearch($event.target.value)">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </div>
        
        <div class="action-buttons">
          <button mat-raised-button color="primary" (click)="addComparison()">
            <mat-icon>compare</mat-icon>
            {{ 'clientInsights.addComparison' | translate }}
          </button>
          <button mat-raised-button color="accent" (click)="generateReport()">
            <mat-icon>assessment</mat-icon>
            {{ 'clientInsights.generate' | translate }}
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Professional Chart Section -->
  <mat-card class="chart-section-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon class="chart-icon">trending_up</mat-icon>
        {{ selectedFilter }} Analytics
      </mat-card-title>
      <mat-card-subtitle>Análisis de tendencias y rendimiento</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="chart-legend">
        <mat-chip-set>
          <mat-chip *ngFor="let item of legendData" class="legend-chip">
            <div class="legend-dot" [style.background-color]="item.color"></div>
            {{ item.value }}
          </mat-chip>
        </mat-chip-set>
      </div>
      
      <div class="chart-container">
        <div class="chart-area">
          <div class="y-axis">
            <div class="y-label" *ngFor="let label of yAxisLabels">
              {{ label }}
            </div>
          </div>
          
          <div class="chart-line">
            <svg width="100%" height="100%" viewBox="0 0 800 200">
              <!-- horizontal gridlines based on labels count -->
              <ng-container *ngFor="let label of yAxisLabels; let i = index">
                <line [attr.x1]="0" [attr.x2]="800" [attr.y1]="(i/(yAxisLabels.length-1))*200" [attr.y2]="(i/(yAxisLabels.length-1))*200" stroke="#e9ecef" stroke-width="1" />
              </ng-container>
              <polyline
                [attr.points]="getChartPoints()"
                fill="none"
                stroke="#2E7D32"
                stroke-width="3"
              />
              <circle
                *ngFor="let point of getChartPointsArray()"
                [attr.cx]="point.x"
                [attr.cy]="point.y"
                r="6"
                fill="#2E7D32"
                stroke="white"
                stroke-width="3"
              />
            </svg>
          </div>
          
          <div class="x-axis">
            <div class="x-label" *ngFor="let data of analyticsData.sales">
              {{ data.month }}
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Professional Data Table -->
  <mat-card class="table-section-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon class="table-icon">table_chart</mat-icon>
        Datos Detallados de Clientes
      </mat-card-title>
      <mat-card-subtitle>Análisis comparativo y métricas de rendimiento</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="dataSource" matSort class="insights-table">

          <ng-container matColumnDef="favorite">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              <mat-icon>star</mat-icon>
              <div class="column-filter">
                <button mat-icon-button aria-label="toggle favorites" (click)="toggleFavFilter()"><mat-icon>star</mat-icon></button>
              </div>
            </th>
            <td mat-cell *matCellDef="let row">
              <button mat-icon-button (click)="toggleFavorite(row)">
                <mat-icon>{{ row.favorite ? 'star' : 'star_border' }}</mat-icon>
              </button>
            </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'common.customer' | translate }}
              <div class="column-filter">
                <mat-form-field appearance="standard" class="mini-field full">
                  <input matInput placeholder="{{ 'common.search' | translate }}" (input)="applySearch($event.target.value)">
                </mat-form-field>
              </div>
            </th>
            <td mat-cell *matCellDef="let row" class="customer-cell">
              <div class="customer-info">
                <div class="customer-indicator" [style.background-color]="row.color"></div>
                <span class="customer-name">{{ row.name }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="sales">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'common.sales' | translate }}
              <div class="column-filter">
                <mat-form-field appearance="outline" class="mini-field">
                  <mat-label>Min</mat-label>
                  <input matInput type="number" (input)="setRange('sales','Min',$event.target.value)">
                </mat-form-field>
                <mat-form-field appearance="outline" class="mini-field">
                  <mat-label>Max</mat-label>
                  <input matInput type="number" (input)="setRange('sales','Max',$event.target.value)">
                </mat-form-field>
              </div>
            </th>
            <td mat-cell *matCellDef="let row" class="sales-cell">
              <span class="sales-value">${{ row.sales | number }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="orders">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'common.orders' | translate }}
              <div class="column-filter">
                <mat-form-field appearance="outline" class="mini-field">
                  <mat-label>Min</mat-label>
                  <input matInput type="number" (input)="setRange('orders','Min',$event.target.value)">
                </mat-form-field>
                <mat-form-field appearance="outline" class="mini-field">
                  <mat-label>Max</mat-label>
                  <input matInput type="number" (input)="setRange('orders','Max',$event.target.value)">
                </mat-form-field>
              </div>
            </th>
            <td mat-cell *matCellDef="let row" class="orders-cell">
              <span class="orders-value">{{ row.orders | number }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="averageOrder">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'clientInsights.averageOrder' | translate }}
              <div class="column-filter">
                <mat-form-field appearance="outline" class="mini-field">
                  <mat-label>Min</mat-label>
                  <input matInput type="number" (input)="setRange('averageOrder','Min',$event.target.value)">
                </mat-form-field>
                <mat-form-field appearance="outline" class="mini-field">
                  <mat-label>Max</mat-label>
                  <input matInput type="number" (input)="setRange('averageOrder','Max',$event.target.value)">
                </mat-form-field>
              </div>
            </th>
            <td mat-cell *matCellDef="let row" class="avg-order-cell">
              <span class="avg-order-value">${{ row.averageOrder }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="frequency">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'clientInsights.frequency' | translate }}
              <div class="column-filter">
                <mat-form-field appearance="outline" class="mini-field">
                  <mat-label>Min</mat-label>
                  <input matInput type="number" (input)="setRange('frequency','Min',$event.target.value)">
                </mat-form-field>
                <mat-form-field appearance="outline" class="mini-field">
                  <mat-label>Max</mat-label>
                  <input matInput type="number" (input)="setRange('frequency','Max',$event.target.value)">
                </mat-form-field>
              </div>
            </th>
            <td mat-cell *matCellDef="let row" class="frequency-cell">
              <mat-chip class="frequency-chip">{{ row.frequency }}</mat-chip>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header-row"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-data-row"></tr>
        </table>
        <mat-paginator [pageSize]="10" [pageSizeOptions]="[10,25,50]" class="table-paginator"></mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="additional-analytics">
    <div class="analytics-grid">
      <mat-card class="analytics-card top-clients-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon class="card-icon">emoji_events</mat-icon>
            Top Performing Clients
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="performance-list">
            <div class="performance-item" *ngFor="let customer of customerData.slice(0, 3)">
              <div class="performance-rank">{{ customerData.indexOf(customer) + 1 }}</div>
              <div class="performance-info">
                <span class="customer-name">{{ customer.name }}</span>
                <span class="performance-value">{{ customer.orders | number }} pedidos</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
      
      <div class="analytics-card">
        <h4>Trend Analysis</h4>
        <div class="trend-info">
          <div class="trend-item">
            <span class="trend-label">Growth Rate:</span>
            <span class="trend-value positive">+12.5%</span>
          </div>
          <div class="trend-item">
            <span class="trend-label">Average Order Value:</span>
            <span class="trend-value">${{ summaryTotals.averageValue }}</span>
          </div>
          <div class="trend-item">
            <span class="trend-label">Order Frequency:</span>
            <span class="trend-value">{{ summaryTotals.averageOrder }} orders/month</span>
          </div>
        </div>
      </div>
      
      <div class="analytics-card">
        <h4>Seasonal Patterns</h4>
        <div class="seasonal-info">
          <div class="season-item">
            <span class="season-label">Peak Season:</span>
            <span class="season-value">May-June</span>
          </div>
          <div class="season-item">
            <span class="season-label">Low Season:</span>
            <span class="season-value">Oct-Nov</span>
          </div>
          <div class="season-item">
            <span class="season-label">Growth Trend:</span>
            <span class="season-value positive">Upward</span>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-actions">
      <button class="export-btn" (click)="exportData()">
        <i class="icon-export"></i> {{ 'common.export' | translate }}
      </button>
    </div>
  </div>
</div>