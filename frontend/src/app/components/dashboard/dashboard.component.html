<div class="dashboard-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">Client Insights</h1>
  </div>

  <!-- Filter and Control Bar -->
  <div class="controls-bar">
    <div class="filter-section">
      <!-- Choose Filter Dropdown -->
      <div class="filter-dropdown" [class.open]="showFilterDropdown">
        <span class="filter-label" (click)="toggleFilterDropdown()">
          + Choose filter
          <i class="dropdown-arrow" [class.rotated]="showFilterDropdown">▼</i>
        </span>
        <div class="dropdown-menu" *ngIf="showFilterDropdown">
          <div class="dropdown-item" 
               *ngFor="let filter of availableFilters"
               (click)="addFilter(filter)">
            {{ filter.label }}
          </div>
        </div>
      </div>

      <!-- Active Filter Tabs -->
      <div class="filter-tabs">
        <button 
          *ngFor="let filter of filters"
          class="filter-tab"
          [class.active]="selectedFilter === filter.value"
          (click)="onFilterChange(filter.value)">
          {{ filter.label }}
          <span class="remove-filter" (click)="removeFilter(filter.value); $event.stopPropagation()">×</span>
        </button>
      </div>

      <!-- Date Range -->
      <div class="date-range">
        <input 
          type="date" 
          [(ngModel)]="dateRange.from" 
          (change)="onDateRangeChange()"
          class="date-input">
        <span class="date-separator">-</span>
        <input 
          type="date" 
          [(ngModel)]="dateRange.to" 
          (change)="onDateRangeChange()"
          class="date-input">
      </div>

      <!-- Additional Filters -->
      <div class="additional-filters" *ngIf="additionalFilters.length > 0">
        <div class="filter-chip" 
             *ngFor="let filter of additionalFilters"
             [class.active]="filter.active"
             (click)="toggleAdditionalFilter(filter)">
          {{ filter.label }}
        </div>
      </div>

      <!-- Comparison Section -->
      <div class="comparison-section" *ngIf="showComparison">
        <div class="comparison-filters">
          <h4>Comparison Filters:</h4>
          <div class="date-range">
            <label>From:</label>
            <input 
              type="date" 
              [ngModel]="comparisonFilters.dateRange?.from" 
              (ngModelChange)="comparisonFilters.dateRange = { ...comparisonFilters.dateRange, from: $event }" 
              class="date-input">
            <label>To:</label>
            <input 
              type="date" 
              [ngModel]="comparisonFilters.dateRange?.to" 
              (ngModelChange)="comparisonFilters.dateRange = { ...comparisonFilters.dateRange, to: $event }" 
              class="date-input">
          </div>
          <button class="apply-comparison-btn" (click)="applyComparison()">
            Apply Comparison
          </button>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="comparison-btn" (click)="addComparison()">
          {{ showComparison ? 'Hide comparison' : 'Add comparison' }}
        </button>
        
        <button class="generate-btn" 
                (click)="generateReport()"
                [disabled]="isLoading">
          <span *ngIf="isLoading">Generating...</span>
          <span *ngIf="!isLoading">Generate</span>
        </button>
      </div>
    </div>

    <!-- Legend Section -->
    <div class="legend-section">
      <div class="legend-item" *ngFor="let item of legendData">
        <div class="legend-dot" [style.background-color]="item.color"></div>
        <span class="legend-value">{{ item.value }}</span>
        <span class="legend-label" *ngIf="item.label">{{ item.label }}</span>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-indicator" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <span>Loading analytics data...</span>
  </div>

  <!-- Line Graph -->
  <div class="chart-section" [class.loading]="isLoading">
    <div class="chart-container">
      <div class="line-chart">
        <div class="chart-area">
          <!-- Y-axis labels -->
          <div class="y-axis">
            <div class="y-label" *ngFor="let label of yAxisLabels">
              {{ label }}
            </div>
          </div>

          <!-- Chart line -->
          <div class="chart-line">
            <svg width="100%" height="100%" viewBox="0 0 800 200">
              <polyline
                [attr.points]="getChartPoints()"
                fill="none"
                stroke="#20B2AA"
                stroke-width="3"
              />
              <circle
                *ngFor="let point of getChartPointsArray()"
                [attr.cx]="point.x"
                [attr.cy]="point.y"
                r="4"
                fill="#20B2AA"
                stroke="white"
                stroke-width="2"
              />
            </svg>
          </div>

          <!-- X-axis labels -->
          <div class="x-axis">
            <div class="x-label" *ngFor="let data of analyticsData">
              {{ data.month }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Customer Performance Table -->
  <div class="table-section">
    <div class="table-container">
      <table class="performance-table">
        <thead>
          <tr>
            <th>Customer</th>
            <th>Sales</th>
            <th>Orders</th>
            <th>Average order...</th>
            <th>Frequency</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let customer of customerData; trackBy: trackByCustomer">
            <td class="customer-cell">
              <div class="customer-indicator" [style.background-color]="customer.color"></div>
              {{ customer.name }}
            </td>
            <td class="sales-cell">{{ customer.sales | number }}</td>
            <td class="orders-cell">{{ customer.orders }}</td>
            <td class="avg-order-cell">{{ customer.averageOrder | number }}</td>
            <td class="frequency-cell">{{ customer.frequency }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="summary-row">
            <td><strong>Amount of stores: {{ summaryTotals.totalStores }}</strong></td>
            <td><strong>Total: {{ summaryTotals.totalSales | number }}</strong></td>
            <td><strong>{{ summaryTotals.totalOrders | number }}</strong></td>
            <td><strong>{{ summaryTotals.averageOrder | number }}</strong></td>
            <td><strong>{{ summaryTotals.averageFrequency }}</strong></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <!-- Annotations -->
  <div class="annotations">
    <div class="annotation-item">
      <span>GRAPHIC (filters): sales orders</span>
    </div>
    <div class="annotation-item">
      <span>LIST (Filters)</span>
    </div>
  </div>
</div>