<div class="admin-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-left">
      <h1>
        <mat-icon>admin_panel_settings</mat-icon>
        Admin Dashboard
      </h1>
    </div>
    
    <div class="search-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search users, products, orders... (Ctrl+K)</mat-label>
        <input 
          matInput
          type="text" 
          [(ngModel)]="searchQuery" 
          (input)="performSearch(searchQuery)"
          (keydown.escape)="clearSearch()"
          placeholder="Search users, products, orders... (Ctrl+K)">
        <mat-icon matPrefix>search</mat-icon>
        <button mat-icon-button matSuffix *ngIf="searchQuery" (click)="clearSearch()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
    
    <div class="control-buttons">
      <button 
        [class.active]="autoRefresh"
        (click)="toggleAutoRefresh()" 
        matTooltip="Toggle auto-refresh ({{ autoRefresh ? 'ON' : 'OFF' }})">
        <mat-icon>{{ autoRefresh ? 'sync' : 'sync_disabled' }}</mat-icon>
      </button>
      <button (click)="refreshData()" [disabled]="isLoading" matTooltip="Refresh">
        <mat-icon>refresh</mat-icon>
      </button>
      <button (click)="navigateToBuyerDashboard()">Buyer View</button>
      <button (click)="navigateToSupplierDashboard()">Supplier View</button>
    </div>
    
    <div class="user-info">
      <span>admin&#64;cesto.com</span>
      <button class="logout-btn">Logout</button>
    </div>
  </div>

  <!-- Search Results Dropdown -->
  <div class="search-results" *ngIf="showSearchResults && searchResults.length > 0">
    <div class="search-result-item" *ngFor="let result of searchResults">
      <div class="result-icon">
        <mat-icon>{{ result.type === 'user' ? 'person' : result.type === 'product' ? 'inventory' : 'receipt' }}</mat-icon>
      </div>
      <div class="result-content">
        <div class="result-title">{{ result.name || result.id }}</div>
        <div class="result-subtitle">{{ result.email || result.category || result.status }}</div>
      </div>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content">
    <!-- Navigation Sidebar -->
    <div class="sidebar">
      <div class="sidebar-section">
        <div class="section-title">Overview</div>
        <ul class="sidebar-nav">
          <li class="nav-item">
            <a class="nav-link" [class.active]="currentView === 'dashboard'" (click)="setCurrentView('dashboard')">
              <mat-icon class="nav-icon">dashboard</mat-icon>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="currentView === 'users'" (click)="setCurrentView('users')">
              <mat-icon class="nav-icon">people</mat-icon>
              Users
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="currentView === 'analytics'" (click)="setCurrentView('analytics')">
              <mat-icon class="nav-icon">analytics</mat-icon>
              Analytics
            </a>
          </li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="section-title">Management</div>
        <ul class="sidebar-nav">
          <li class="nav-item">
            <a class="nav-link" [class.active]="currentView === 'system'" (click)="setCurrentView('system')">
              <mat-icon class="nav-icon">settings</mat-icon>
              System Config
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="currentView === 'logs'" (click)="setCurrentView('logs')">
              <mat-icon class="nav-icon">description</mat-icon>
              Logs
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Dashboard View -->
      <div *ngIf="currentView === 'dashboard'">
        <div class="content-header">
          <h1 class="page-title">Dashboard Overview</h1>
          <p class="page-subtitle">Monitor system performance and user activity</p>
        </div>

        <!-- Global Statistics -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Total Users</div>
              <div class="stat-icon">
                <mat-icon>people</mat-icon>
              </div>
            </div>
            <div class="stat-value">{{ globalStats.totalUsers | number }}</div>
            <div class="stat-change positive">
              <mat-icon class="change-icon">trending_up</mat-icon>
              +12% from last month
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Active Users</div>
              <div class="stat-icon">
                <mat-icon>person</mat-icon>
              </div>
            </div>
            <div class="stat-value">{{ globalStats.activeUsers | number }}</div>
            <div class="stat-change positive">
              <mat-icon class="change-icon">trending_up</mat-icon>
              +8% from last month
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Total Revenue</div>
              <div class="stat-icon">
                <mat-icon>attach_money</mat-icon>
              </div>
            </div>
            <div class="stat-value">â‚¬{{ globalStats.revenueStats.totalRevenue | number }}</div>
            <div class="stat-change positive">
              <mat-icon class="change-icon">trending_up</mat-icon>
              +15% from last month
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">System Health</div>
              <div class="stat-icon">
                <mat-icon>health_and_safety</mat-icon>
              </div>
            </div>
            <div class="stat-value">{{ globalStats.systemHealth.uptime }}</div>
            <div class="stat-change neutral">
              <mat-icon class="change-icon">check_circle</mat-icon>
              All systems operational
            </div>
          </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">User Growth</div>
              <div class="chart-actions">
                <button class="chart-action">7D</button>
                <button class="chart-action">30D</button>
                <button class="chart-action">90D</button>
              </div>
            </div>
            <div class="chart-content">
              ðŸ“ˆ User growth chart will be displayed here
            </div>
          </div>

          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Revenue Trends</div>
              <div class="chart-actions">
                <button class="chart-action">Export</button>
              </div>
            </div>
            <div class="chart-content">
              ðŸ’° Revenue trends chart will be displayed here
            </div>
          </div>
        </div>

        <!-- Recent Activity Table -->
        <div class="data-table">
          <div class="table-header">
            <div class="table-title">Recent Activity</div>
            <div class="table-actions">
              <button class="action-button secondary">
                <mat-icon>download</mat-icon>
                Export
              </button>
              <button class="action-button">
                <mat-icon>refresh</mat-icon>
                Refresh
              </button>
            </div>
          </div>
          <div class="table-content">
            <table>
              <thead>
                <tr>
                  <th>User</th>
                  <th>Action</th>
                  <th>Timestamp</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let activity of recentActivity">
                  <td>{{ activity.user }}</td>
                  <td>{{ activity.action }}</td>
                  <td>{{ activity.timestamp | date:'short' }}</td>
                  <td>
                    <span class="status-badge" [class]="'status-' + activity.status">
                      {{ activity.status }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Users Management View -->
      <div *ngIf="currentView === 'users'">
        <div class="content-header">
          <h1 class="page-title">User Management</h1>
          <p class="page-subtitle">Manage user accounts and permissions</p>
        </div>

        <!-- User Statistics -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Total Users</div>
              <div class="stat-icon">
                <mat-icon>people</mat-icon>
              </div>
            </div>
            <div class="stat-value">{{ totalUsers | number }}</div>
            <div class="stat-change positive">
              <mat-icon class="change-icon">trending_up</mat-icon>
              +{{ userGrowthData.length }} this month
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Active Users</div>
              <div class="stat-icon">
                <mat-icon>person</mat-icon>
              </div>
            </div>
            <div class="stat-value">{{ getActiveUsersCount() | number }}</div>
            <div class="stat-change positive">
              <mat-icon class="change-icon">check_circle</mat-icon>
              {{ getActiveUsersPercentage() }}% of total
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">New This Week</div>
              <div class="stat-icon">
                <mat-icon>person_add</mat-icon>
              </div>
            </div>
            <div class="stat-value">{{ getNewUsersThisWeek() | number }}</div>
            <div class="stat-change positive">
              <mat-icon class="change-icon">trending_up</mat-icon>
              +{{ getNewUsersGrowth() }}% from last week
            </div>
          </div>
        </div>

        <!-- Users Table -->
        <div class="data-table">
          <div class="table-header">
            <div class="table-title">Users ({{ getTotalUsersCount() }})</div>
            <div class="table-actions">
              <button class="action-button secondary" (click)="exportUsers()">
                <mat-icon>download</mat-icon>
                Export
              </button>
              <button class="action-button" (click)="openCreateUserModal()">
                <mat-icon>person_add</mat-icon>
                Add User
              </button>
            </div>
          </div>
          <div class="table-content">
            <table>
              <thead>
                <tr>
                  <th>User</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Last Login</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users">
                  <td>
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--color-primary-main); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                        {{ user.name?.charAt(0) || 'U' }}
                      </div>
                      <div>
                        <div style="font-weight: 600;">{{ user.name || 'Unknown' }}</div>
                        <div style="font-size: 12px; color: var(--color-text-secondary);">ID: {{ user.id }}</div>
                      </div>
                    </div>
                  </td>
                  <td>{{ user.email }}</td>
                  <td>
                    <span style="padding: 4px 12px; background: var(--color-background-tertiary); border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase;">
                      {{ user.role }}
                    </span>
                  </td>
                  <td>
                    <span class="status-badge" [class]="'status-' + user.status">
                      {{ user.status }}
                    </span>
                  </td>
                  <td>{{ user.lastLogin | date:'short' }}</td>
                  <td>
                    <div style="display: flex; gap: 8px;">
                      <button (click)="editUser(user)" style="padding: 6px; border: 1px solid var(--color-border-primary); background: white; border-radius: 6px; cursor: pointer; color: var(--color-text-secondary);">
                        <mat-icon style="font-size: 16px;">edit</mat-icon>
                      </button>
                      <button (click)="deleteUser(user)" style="padding: 6px; border: 1px solid var(--color-border-primary); background: white; border-radius: 6px; cursor: pointer; color: var(--color-text-secondary);">
                        <mat-icon style="font-size: 16px;">delete</mat-icon>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="pagination">
            <div class="pagination-info">
              Showing {{ (currentPage - 1) * pageSize + 1 }} to {{ Math.min(currentPage * pageSize, totalUsers) }} of {{ totalUsers }} users
            </div>
            <div class="pagination-controls">
              <button class="pagination-button" [disabled]="currentPage === 1" (click)="previousPage()">
                Previous
              </button>
              <button class="pagination-button active">{{ currentPage }}</button>
              <button class="pagination-button" [disabled]="currentPage * pageSize >= totalUsers" (click)="nextPage()">
                Next
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Analytics View -->
      <div *ngIf="currentView === 'analytics'">
        <div class="content-header">
          <h1 class="page-title">Analytics</h1>
          <p class="page-subtitle">Detailed analytics and insights</p>
        </div>

        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Sales Analytics</div>
              <div class="chart-actions">
                <button class="chart-action">Export</button>
              </div>
            </div>
            <div class="chart-content">
              ðŸ“Š Sales analytics chart will be displayed here
            </div>
          </div>

          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">User Engagement</div>
              <div class="chart-actions">
                <button class="chart-action">Export</button>
              </div>
            </div>
            <div class="chart-content">
              ðŸ“ˆ User engagement metrics will be displayed here
            </div>
          </div>
        </div>
      </div>

      <!-- System Config View -->
      <div *ngIf="currentView === 'system'">
        <div class="content-header">
          <h1 class="page-title">System Configuration</h1>
          <p class="page-subtitle">Manage system settings and configuration</p>
        </div>

        <div class="data-table">
          <div class="table-header">
            <div class="table-title">System Settings</div>
            <div class="table-actions">
              <button class="action-button">
                <mat-icon>save</mat-icon>
                Save Changes
              </button>
            </div>
          </div>
          <div class="table-content">
            <table>
              <thead>
                <tr>
                  <th>Setting</th>
                  <th>Value</th>
                  <th>Description</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let config of systemConfig">
                  <td style="font-weight: 600;">{{ config.key }}</td>
                  <td>{{ config.value }}</td>
                  <td>{{ config.description }}</td>
                  <td>
                    <button style="padding: 6px; border: 1px solid var(--color-border-primary); background: white; border-radius: 6px; cursor: pointer; color: var(--color-text-secondary);">
                      <mat-icon style="font-size: 16px;">edit</mat-icon>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Logs View -->
      <div *ngIf="currentView === 'logs'">
        <div class="content-header">
          <h1 class="page-title">System Logs</h1>
          <p class="page-subtitle">Monitor system logs and events</p>
        </div>

        <div class="data-table">
          <div class="table-header">
            <div class="table-title">Recent Logs</div>
            <div class="table-actions">
              <button class="action-button secondary">
                <mat-icon>download</mat-icon>
                Export Logs
              </button>
              <button class="action-button">
                <mat-icon>refresh</mat-icon>
                Refresh
              </button>
            </div>
          </div>
          <div class="table-content">
            <table>
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>Level</th>
                  <th>Message</th>
                  <th>Source</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let log of systemLogs">
                  <td>{{ log.timestamp | date:'short' }}</td>
                  <td>
                    <span class="status-badge" [class]="'status-' + log.level">
                      {{ log.level }}
                    </span>
                  </td>
                  <td>{{ log.message }}</td>
                  <td>{{ log.source }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create User Modal -->
  <div class="modal-overlay" *ngIf="showCreateUserModal" (click)="closeCreateUserModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Create New User</h3>
        <button class="modal-close" (click)="closeCreateUserModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <form [formGroup]="userForm" (ngSubmit)="createUser()">
        <div class="form-group">
          <label class="form-label">Name</label>
          <input class="form-input" type="text" formControlName="name" placeholder="Enter user name">
        </div>

        <div class="form-group">
          <label class="form-label">Email</label>
          <input class="form-input" type="email" formControlName="email" placeholder="Enter email address">
        </div>

        <div class="form-group">
          <label class="form-label">Role</label>
          <select class="form-select" formControlName="role">
            <option value="admin">Admin</option>
            <option value="user">User</option>
            <option value="moderator">Moderator</option>
          </select>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-outline" (click)="closeCreateUserModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid || isLoading">
            Create User
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner"></div>
  </div>
</div>